### =========================================================================###
### Exercises in Marine Ecological Genetics 2023                             ###
### 10. DNA barcoding                                                        ###
### ======================================================================== ###


### Preparations

# On Windows, install and launch BioEdit
# zipped installation file provided in meg23_repo/other
# or download from https://bioedit.software.informer.com/

# On Mac, launch 4Peaks
# executable provided in meg23_repo/other

# Copy trace files to local working directory
# cp meg23_repo/data/barcode/trace* .


### ============================================================================
### Exercise 1: Extract COI barcode from Sanger trace files

### Background â€“ PCR / sequencing primers used for COI:

# VF2_t1    tgtaaaacgacggccagtCAACCAACCACAAAGACATTGGCAC
# FishF2_t1 tgtaaaacgacggccagtCGACTAATCATAAAGATATCGGCAC
# FishR2_t1 caggaaacagctatgacACTTCAGGGTGACCGAAGAATCAGAA
# FR1d_t1   caggaaacagctatgacACCTCAGGGTGTCCGAARAAYCARAA

# Amplify approx. 650 bp fragment in 5' region of COI
# M13-tailed primers (Ivanova et al. 2007, Molecluar Ecology Notes, lower case = tail)


### View trace files

# Open trace files in BioEdit (Windows) or 4Peaks (Mac)
# Note that each sample was sequenced in forward and reverse direction: *_F.ab1, *_R.ab1
# How many positions at the beginning (5') and end (3') look unreliable?


### Trim low quality 5' and 3' positions

# BioEdit: select range of positions to keep, copy selection (Ctrl + C) to plain text file
# 4Peaks: select range of positions to keep, crop (Cmd + K) and export as plain text file
# Save as trimmed_*F.fas, trimmed_*R.fas


### Reverse complement trimmed R sequence
# http://www.reverse-complement.com/
# Save as revcomp_*R.fas

# Alternatively, run on cluster: 
ml EMBOSS/6.6.0
revseq trimmed_10R.fas revcomp_10R.fas


### Align sequences using Clustal Omega
# https://www.ebi.ac.uk/Tools/msa/clustalo/
# Select DNA, output format Pearson/FASTA
# Paste trimmed_10F.fas and revcomp_10R.fas
# Submit and save as aligned_*.aln


# Create consensus sequence with Cons
# https://www.ebi.ac.uk/Tools/msa/emboss_cons/
# select DNA, change name to *_con
# save as *_con.fas

# Compile consensus sequences in one file
cd meg_ss22/data/barcode/fasta
cat *_con.fas > ../co1.fas



### Identify species of samples based on barcode

# Barcode of Life Data System (BOLD): http://www.boldsystems.org/index.php/
# select Identification, Animal Identification (COI), Species Level Barcode Records
# explore species, BIN and tree pages
# evaluate id quality based on similarity score, within-BIN and NN distances



### ============================================================================
### Bonus material

### Alternative to BOLD: identify sample with BLAST and the NCBI nt database

# https://blast.ncbi.nlm.nih.gov/Blast.cgi
# select Nucleotide BLAST, Nucleotide collection (nr/nt), megablast



### Build phylogenetic tree of barcodes with MAFFT

# https://mafft.cbrc.jp/alignment/server/
# align consensus sequences with default settings
# select phylogenetic tree with NJ, Jukes-Cantor model, Bootstrap on settings
# view tree on Phylo.io



### ============================================================================
### Solutions

### Species ID of samples

# 10: Oncorhynchus keta                      100%
# 11: Gadus chalcogrammus                    100%
# 14: Platichthys flesus / Pleuronectes sp.  100%
# 15: Gadus chalcogrammus                    100%
# 19: Gadus chalcogrammus                    100%
# 20: Platichthys flesus / Pleuronectes sp.  100%
